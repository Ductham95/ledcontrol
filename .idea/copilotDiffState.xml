<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/build.gradle.kts">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/build.gradle.kts" />
              <option name="originalContent" value="plugins {&#10;    alias(libs.plugins.android.application)&#10;    alias(libs.plugins.kotlin.android)&#10;    alias(libs.plugins.kotlin.compose)&#10;}&#10;&#10;android {&#10;    namespace = &quot;com.example.ledcontrol&quot;&#10;    compileSdk = 35&#10;&#10;    defaultConfig {&#10;        applicationId = &quot;com.example.ledcontrol&quot;&#10;        minSdk = 24&#10;        targetSdk = 35&#10;        versionCode = 1&#10;        versionName = &quot;1.0&quot;&#10;&#10;        testInstrumentationRunner = &quot;androidx.test.runner.AndroidJUnitRunner&quot;&#10;    }&#10;&#10;    buildTypes {&#10;        release {&#10;            isMinifyEnabled = false&#10;            proguardFiles(&#10;                getDefaultProguardFile(&quot;proguard-android-optimize.txt&quot;),&#10;                &quot;proguard-rules.pro&quot;&#10;            )&#10;        }&#10;    }&#10;    compileOptions {&#10;        sourceCompatibility = JavaVersion.VERSION_11&#10;        targetCompatibility = JavaVersion.VERSION_11&#10;    }&#10;    kotlinOptions {&#10;        jvmTarget = &quot;11&quot;&#10;    }&#10;    buildFeatures {&#10;        compose = true&#10;    }&#10;}&#10;&#10;dependencies {&#10;&#10;    implementation(libs.androidx.core.ktx)&#10;    implementation(libs.androidx.lifecycle.runtime.ktx)&#10;    implementation(libs.androidx.activity.compose)&#10;    implementation(platform(libs.androidx.compose.bom))&#10;    implementation(libs.androidx.ui)&#10;    implementation(libs.androidx.ui.graphics)&#10;    implementation(libs.androidx.ui.tooling.preview)&#10;    implementation(libs.androidx.material3)&#10;    testImplementation(libs.junit)&#10;    androidTestImplementation(libs.androidx.junit)&#10;    androidTestImplementation(libs.androidx.espresso.core)&#10;    androidTestImplementation(platform(libs.androidx.compose.bom))&#10;    androidTestImplementation(libs.androidx.ui.test.junit4)&#10;    debugImplementation(libs.androidx.ui.tooling)&#10;    debugImplementation(libs.androidx.ui.test.manifest)&#10;    implementation(&quot;org.eclipse.paho:org.eclipse.paho.client.mqttv3:1.2.5&quot;)&#10;    implementation(&quot;androidx.compose.material:material-icons-extended:1.6.0&quot;)&#10;}" />
              <option name="updatedContent" value="plugins {&#10;    alias(libs.plugins.android.application)&#10;    alias(libs.plugins.kotlin.android)&#10;    alias(libs.plugins.kotlin.compose)&#10;}&#10;&#10;android {&#10;    namespace = &quot;com.example.ledcontrol&quot;&#10;    compileSdk = 35&#10;&#10;    defaultConfig {&#10;        applicationId = &quot;com.example.ledcontrol&quot;&#10;        minSdk = 24&#10;        targetSdk = 35&#10;        versionCode = 1&#10;        versionName = &quot;1.0&quot;&#10;&#10;        testInstrumentationRunner = &quot;androidx.test.runner.AndroidJUnitRunner&quot;&#10;    }&#10;&#10;    buildTypes {&#10;        release {&#10;            isMinifyEnabled = false&#10;            proguardFiles(&#10;                getDefaultProguardFile(&quot;proguard-android-optimize.txt&quot;),&#10;                &quot;proguard-rules.pro&quot;&#10;            )&#10;        }&#10;    }&#10;    compileOptions {&#10;        sourceCompatibility = JavaVersion.VERSION_11&#10;        targetCompatibility = JavaVersion.VERSION_11&#10;    }&#10;    kotlinOptions {&#10;        jvmTarget = &quot;11&quot;&#10;    }&#10;    buildFeatures {&#10;        compose = true&#10;    }&#10;}&#10;&#10;dependencies {&#10;&#10;    implementation(libs.androidx.core.ktx)&#10;    implementation(libs.androidx.lifecycle.runtime.ktx)&#10;    implementation(libs.androidx.activity.compose)&#10;    implementation(platform(libs.androidx.compose.bom))&#10;    implementation(libs.androidx.ui)&#10;    implementation(libs.androidx.ui.graphics)&#10;    implementation(libs.androidx.ui.tooling.preview)&#10;    implementation(libs.androidx.material3)&#10;    testImplementation(libs.junit)&#10;    androidTestImplementation(libs.androidx.junit)&#10;    androidTestImplementation(libs.androidx.espresso.core)&#10;    androidTestImplementation(platform(libs.androidx.compose.bom))&#10;    androidTestImplementation(libs.androidx.ui.test.junit4)&#10;    debugImplementation(libs.androidx.ui.tooling)&#10;    debugImplementation(libs.androidx.ui.test.manifest)&#10;    implementation(&quot;org.eclipse.paho:org.eclipse.paho.client.mqttv3:1.2.5&quot;)&#10;    implementation(&quot;androidx.compose.material:material-icons-extended:1.6.0&quot;)&#10;    implementation(&quot;com.google.code.gson:gson:2.10.1&quot;)&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/ledcontrol/MainActivity.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/ledcontrol/MainActivity.kt" />
              <option name="originalContent" value="package com.example.ledcontrol&#10;&#10;import android.os.Bundle&#10;import android.util.Log&#10;import androidx.activity.ComponentActivity&#10;import androidx.activity.compose.setContent&#10;import androidx.activity.enableEdgeToEdge&#10;import androidx.compose.animation.animateColorAsState&#10;import androidx.compose.animation.core.*&#10;import androidx.compose.foundation.Canvas&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.border&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.interaction.MutableInteractionSource&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyRow&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.foundation.verticalScroll&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.filled.Send&#10;import androidx.compose.material.icons.filled.Lightbulb&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.blur&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.draw.scale&#10;import androidx.compose.ui.draw.shadow&#10;import androidx.compose.ui.graphics.Brush&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.graphics.drawscope.Stroke&#10;import androidx.compose.ui.layout.Layout&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.example.ledcontrol.ui.theme.LedControlTheme&#10;import org.eclipse.paho.client.mqttv3.*&#10;import org.eclipse.paho.client.mqttv3.persist.MemoryPersistence&#10;import java.util.UUID&#10;import kotlin.math.cos&#10;import kotlin.math.sin&#10;&#10;// MQTT Configuration&#10;const val MQTT_SERVER = &quot;ssl://76bf78e5731240cbb090e3284089c085.s1.eu.hivemq.cloud:8883&quot;&#10;const val MQTT_USER = &quot;hivemq.webclient.1765688353696&quot;&#10;const val MQTT_PASS = &quot;r8&gt;!lHMZ37RYzy?5&lt;Sxv&quot;&#10;const val TOPIC_PREFIX = &quot;esp32/controlled/&quot;&#10;&#10;// Beautiful color palette&#10;val DarkBackground = Color(0xFF0D1117)&#10;val CardBackground = Color(0xFF161B22)&#10;val AccentCyan = Color(0xFF00D9FF)&#10;val AccentPurple = Color(0xFF8B5CF6)&#10;val AccentPink = Color(0xFFEC4899)&#10;val AccentGreen = Color(0xFF10B981)&#10;&#10;// Data class for LED state&#10;data class LedState(&#10;    val red: Int,&#10;    val green: Int,&#10;    val blue: Int,&#10;    val brightness: Int&#10;)&#10;&#10;// Data class for color palette&#10;data class ColorPalette(&#10;    val name: String,&#10;    val icon: String,&#10;    val colors: List&lt;LedState&gt;&#10;)&#10;&#10;// Helper function to convert HSV to RGB&#10;fun hsvToRgb(h: Float, s: Float, v: Float): Triple&lt;Int, Int, Int&gt; {&#10;    val c = v * s&#10;    val x = c * (1 - kotlin.math.abs((h / 60) % 2 - 1))&#10;    val m = v - c&#10;&#10;    val (r, g, b) = when {&#10;        h &lt; 60 -&gt; Triple(c, x, 0f)&#10;        h &lt; 120 -&gt; Triple(x, c, 0f)&#10;        h &lt; 180 -&gt; Triple(0f, c, x)&#10;        h &lt; 240 -&gt; Triple(0f, x, c)&#10;        h &lt; 300 -&gt; Triple(x, 0f, c)&#10;        else -&gt; Triple(c, 0f, x)&#10;    }&#10;&#10;    return Triple(&#10;        ((r + m) * 255).toInt().coerceIn(0, 255),&#10;        ((g + m) * 255).toInt().coerceIn(0, 255),&#10;        ((b + m) * 255).toInt().coerceIn(0, 255)&#10;    )&#10;}&#10;&#10;// Pre-set color palettes&#10;val presetPalettes = listOf(&#10;    ColorPalette(&#10;        name = &quot;Rainbow&quot;,&#10;        icon = &quot;&quot;,&#10;        colors = List(24) { index -&gt;&#10;            val hue = (index * 15f) % 360f&#10;            val rgb = hsvToRgb(hue, 1f, 1f)&#10;            LedState(rgb.first, rgb.second, rgb.third, 200)&#10;        }&#10;    ),&#10;    ColorPalette(&#10;        name = &quot;Ocean Wave&quot;,&#10;        icon = &quot;&quot;,&#10;        colors = List(24) { index -&gt;&#10;            val phase = (index * 15f) % 360f&#10;            val blue = (200 + 55 * sin(Math.toRadians(phase.toDouble()))).toInt()&#10;            val green = (100 + 100 * sin(Math.toRadians((phase + 60).toDouble()))).toInt()&#10;            LedState(0, green.coerceIn(0, 255), blue.coerceIn(0, 255), 180)&#10;        }&#10;    ),&#10;    ColorPalette(&#10;        name = &quot;Fire&quot;,&#10;        icon = &quot;&quot;,&#10;        colors = List(24) { index -&gt;&#10;            val phase = (index * 15f) % 360f&#10;            val red = 255&#10;            val green = (80 + 80 * sin(Math.toRadians(phase.toDouble()))).toInt()&#10;            LedState(red, green.coerceIn(0, 160), 0, 220)&#10;        }&#10;    ),&#10;    ColorPalette(&#10;        name = &quot;Aurora&quot;,&#10;        icon = &quot;✨&quot;,&#10;        colors = List(24) { index -&gt;&#10;            val phase = index * 15f&#10;            val green = (150 + 105 * sin(Math.toRadians(phase.toDouble()))).toInt()&#10;            val blue = (100 + 155 * cos(Math.toRadians(phase.toDouble()))).toInt()&#10;            val red = (50 + 50 * sin(Math.toRadians((phase * 2).toDouble()))).toInt()&#10;            LedState(red.coerceIn(0, 255), green.coerceIn(0, 255), blue.coerceIn(0, 255), 200)&#10;        }&#10;    ),&#10;    ColorPalette(&#10;        name = &quot;Sunset&quot;,&#10;        icon = &quot;&quot;,&#10;        colors = List(24) { index -&gt;&#10;            val phase = index * 15f&#10;            val red = 255&#10;            val green = (100 + 80 * sin(Math.toRadians(phase.toDouble()))).toInt()&#10;            val blue = (50 + 100 * cos(Math.toRadians((phase + 90).toDouble()))).toInt()&#10;            LedState(red, green.coerceIn(50, 180), blue.coerceIn(0, 150), 200)&#10;        }&#10;    ),&#10;    ColorPalette(&#10;        name = &quot;Christmas&quot;,&#10;        icon = &quot;&quot;,&#10;        colors = List(24) { index -&gt;&#10;            if (index % 2 == 0) LedState(255, 0, 0, 200) else LedState(0, 255, 0, 200)&#10;        }&#10;    ),&#10;    ColorPalette(&#10;        name = &quot;Party&quot;,&#10;        icon = &quot;&quot;,&#10;        colors = List(24) { index -&gt;&#10;            when (index % 4) {&#10;                0 -&gt; LedState(255, 0, 255, 220) // Magenta&#10;                1 -&gt; LedState(0, 255, 255, 220) // Cyan&#10;                2 -&gt; LedState(255, 255, 0, 220) // Yellow&#10;                else -&gt; LedState(255, 100, 0, 220) // Orange&#10;            }&#10;        }&#10;    ),&#10;    ColorPalette(&#10;        name = &quot;Cool White&quot;,&#10;        icon = &quot;❄️&quot;,&#10;        colors = List(24) { LedState(255, 255, 255, 180) }&#10;    ),&#10;    ColorPalette(&#10;        name = &quot;Warm White&quot;,&#10;        icon = &quot;&quot;,&#10;        colors = List(24) { LedState(255, 200, 150, 180) }&#10;    ),&#10;    ColorPalette(&#10;        name = &quot;All Off&quot;,&#10;        icon = &quot;⚫&quot;,&#10;        colors = List(24) { LedState(0, 0, 0, 0) }&#10;    )&#10;)&#10;&#10;class MainActivity : ComponentActivity() {&#10;    private lateinit var mqttClient: MqttClient&#10;&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        super.onCreate(savedInstanceState)&#10;        enableEdgeToEdge()&#10;&#10;        connectMqtt()&#10;&#10;        setContent {&#10;            LedControlTheme {&#10;                Surface(&#10;                    modifier = Modifier.fillMaxSize(),&#10;                    color = DarkBackground&#10;                ) {&#10;                    LedControlScreen(&#10;                        onSendColor = { ledId, r, g, b, brightness -&gt;&#10;                            publishColor(ledId, r, g, b, brightness)&#10;                        },&#10;                        onSendAllColors = { states -&gt;&#10;                            // Send all LED colors with a small delay between each&#10;                            Thread {&#10;                                states.forEachIndexed { index, state -&gt;&#10;                                    publishColor(index.toString(), state.red, state.green, state.blue, state.brightness)&#10;                                    Thread.sleep(50) // Small delay to prevent overwhelming MQTT&#10;                                }&#10;                            }.start()&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    private fun connectMqtt() {&#10;        Thread {&#10;            try {&#10;                val clientId = &quot;AndroidClient_${UUID.randomUUID()}&quot;&#10;                mqttClient = MqttClient(MQTT_SERVER, clientId, MemoryPersistence())&#10;&#10;                val options = MqttConnectOptions().apply {&#10;                    userName = MQTT_USER&#10;                    password = MQTT_PASS.toCharArray()&#10;                    isCleanSession = true&#10;                    connectionTimeout = 30&#10;                    keepAliveInterval = 60&#10;                }&#10;&#10;                mqttClient.connect(options)&#10;                Log.d(&quot;MQTT&quot;, &quot;Connected successfully!&quot;)&#10;            } catch (e: Exception) {&#10;                Log.e(&quot;MQTT&quot;, &quot;Connection failed: ${e.message}&quot;)&#10;            }&#10;        }.start()&#10;    }&#10;&#10;    private fun publishColor(ledId: String, r: Int, g: Int, b: Int, brightness: Int) {&#10;        Thread {&#10;            try {&#10;                if (::mqttClient.isInitialized &amp;&amp; mqttClient.isConnected) {&#10;                    val topic = &quot;$TOPIC_PREFIX$ledId&quot;&#10;                    val payload = &quot;$r,$g,$b,$brightness&quot;&#10;                    mqttClient.publish(topic, payload.toByteArray(), 1, false)&#10;                    Log.d(&quot;MQTT&quot;, &quot;Published to $topic: $payload&quot;)&#10;                }&#10;            } catch (e: Exception) {&#10;                Log.e(&quot;MQTT&quot;, &quot;Publish failed: ${e.message}&quot;)&#10;            }&#10;        }.start()&#10;    }&#10;&#10;    override fun onDestroy() {&#10;        super.onDestroy()&#10;        try {&#10;            if (::mqttClient.isInitialized &amp;&amp; mqttClient.isConnected) {&#10;                mqttClient.disconnect()&#10;            }&#10;        } catch (e: Exception) {&#10;            Log.e(&quot;MQTT&quot;, &quot;Disconnect failed: ${e.message}&quot;)&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun LedControlScreen(&#10;    modifier: Modifier = Modifier,&#10;    onSendColor: (String, Int, Int, Int, Int) -&gt; Unit,&#10;    onSendAllColors: (List&lt;LedState&gt;) -&gt; Unit&#10;) {&#10;    var selectedLed by remember { mutableStateOf(0) }&#10;    var ledStates by remember { mutableStateOf(List(24) { LedState(255, 100, 50, 200) }) }&#10;    var red by remember { mutableStateOf(255f) }&#10;    var green by remember { mutableStateOf(100f) }&#10;    var blue by remember { mutableStateOf(50f) }&#10;    var brightness by remember { mutableStateOf(200f) }&#10;    var showPaletteSelector by remember { mutableStateOf(false) }&#10;&#10;    // Preview color with animation&#10;    val previewColor = Color(&#10;        red = red.toInt(),&#10;        green = green.toInt(),&#10;        blue = blue.toInt(),&#10;        alpha = 255&#10;    )&#10;&#10;    // Animated glow effect&#10;    val infiniteTransition = rememberInfiniteTransition(label = &quot;glow&quot;)&#10;    val glowAlpha by infiniteTransition.animateFloat(&#10;        initialValue = 0.5f,&#10;        targetValue = 1f,&#10;        animationSpec = infiniteRepeatable(&#10;            animation = tween(1000, easing = FastOutSlowInEasing),&#10;            repeatMode = RepeatMode.Reverse&#10;        ),&#10;        label = &quot;glowAlpha&quot;&#10;    )&#10;&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .verticalScroll(rememberScrollState())&#10;            .padding(16.dp)&#10;            .padding(top = 32.dp),&#10;        horizontalAlignment = Alignment.CenterHorizontally,&#10;        verticalArrangement = Arrangement.spacedBy(16.dp)&#10;    ) {&#10;        // Title with gradient&#10;        Text(&#10;            text = &quot;✨ LED Controller&quot;,&#10;            style = MaterialTheme.typography.headlineMedium.copy(&#10;                fontWeight = FontWeight.Bold,&#10;                brush = Brush.linearGradient(&#10;                    colors = listOf(AccentCyan, AccentPurple, AccentPink)&#10;                )&#10;            )&#10;        )&#10;&#10;        // Circular LED Ring with glow effect&#10;        Box(&#10;            modifier = Modifier.size(280.dp),&#10;            contentAlignment = Alignment.Center&#10;        ) {&#10;            // Background glow&#10;            Canvas(modifier = Modifier.size(280.dp)) {&#10;                drawCircle(&#10;                    brush = Brush.radialGradient(&#10;                        colors = listOf(&#10;                            previewColor.copy(alpha = glowAlpha * 0.5f),&#10;                            Color.Transparent&#10;                        )&#10;                    ),&#10;                    radius = size.minDimension / 2&#10;                )&#10;            }&#10;&#10;            // Decorative ring&#10;            Canvas(modifier = Modifier.size(260.dp)) {&#10;                drawCircle(&#10;                    brush = Brush.sweepGradient(&#10;                        colors = listOf(&#10;                            AccentCyan.copy(alpha = 0.3f),&#10;                            AccentPurple.copy(alpha = 0.3f),&#10;                            AccentPink.copy(alpha = 0.3f),&#10;                            AccentCyan.copy(alpha = 0.3f)&#10;                        )&#10;                    ),&#10;                    style = Stroke(width = 2.dp.toPx())&#10;                )&#10;            }&#10;&#10;            CircularLedLayout(&#10;                ledCount = 24,&#10;                selectedLed = selectedLed,&#10;                ledStates = ledStates,&#10;                onLedClick = { index -&gt;&#10;                    ledStates = ledStates.toMutableList().apply {&#10;                        this[selectedLed] = LedState(red.toInt(), green.toInt(), blue.toInt(), brightness.toInt())&#10;                    }&#10;                    selectedLed = index&#10;                    val newState = ledStates[index]&#10;                    red = newState.red.toFloat()&#10;                    green = newState.green.toFloat()&#10;                    blue = newState.blue.toFloat()&#10;                    brightness = newState.brightness.toFloat()&#10;                }&#10;            )&#10;&#10;            // Center preview with glow&#10;            Box(contentAlignment = Alignment.Center) {&#10;                // Glow behind preview&#10;                Box(&#10;                    modifier = Modifier&#10;                        .size(100.dp)&#10;                        .blur(20.dp)&#10;                        .background(previewColor.copy(alpha = glowAlpha), CircleShape)&#10;                )&#10;                // Main preview circle&#10;                Box(&#10;                    modifier = Modifier&#10;                        .size(90.dp)&#10;                        .shadow(8.dp, CircleShape)&#10;                        .clip(CircleShape)&#10;                        .background(&#10;                            Brush.radialGradient(&#10;                                colors = listOf(&#10;                                    previewColor,&#10;                                    previewColor.copy(alpha = 0.8f)&#10;                                )&#10;                            )&#10;                        )&#10;                        .border(3.dp, Color.White.copy(alpha = 0.3f), CircleShape),&#10;                    contentAlignment = Alignment.Center&#10;                ) {&#10;                    Column(horizontalAlignment = Alignment.CenterHorizontally) {&#10;                        Icon(&#10;                            imageVector = Icons.Filled.Lightbulb,&#10;                            contentDescription = &quot;LED&quot;,&#10;                            tint = if ((red + green + blue) / 3 &gt; 128) Color.Black.copy(alpha = 0.7f) else Color.White,&#10;                            modifier = Modifier.size(32.dp)&#10;                        )&#10;                        Text(&#10;                            text = &quot;LED $selectedLed&quot;,&#10;                            fontSize = 12.sp,&#10;                            fontWeight = FontWeight.Bold,&#10;                            color = if ((red + green + blue) / 3 &gt; 128) Color.Black.copy(alpha = 0.8f) else Color.White&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        }&#10;&#10;        // Info Card with glassmorphism effect&#10;        Card(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .shadow(8.dp, RoundedCornerShape(16.dp)),&#10;            shape = RoundedCornerShape(16.dp),&#10;            colors = CardDefaults.cardColors(containerColor = CardBackground)&#10;        ) {&#10;            Row(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .padding(16.dp),&#10;                horizontalArrangement = Arrangement.SpaceEvenly,&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                InfoChip(label = &quot;R&quot;, value = red.toInt(), color = Color.Red)&#10;                InfoChip(label = &quot;G&quot;, value = green.toInt(), color = AccentGreen)&#10;                InfoChip(label = &quot;B&quot;, value = blue.toInt(), color = Color(0xFF3B82F6))&#10;                InfoChip(label = &quot;☀&quot;, value = brightness.toInt(), color = Color.Yellow)&#10;            }&#10;        }&#10;&#10;        // Sliders with beautiful design&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .background(CardBackground, RoundedCornerShape(16.dp))&#10;                .padding(16.dp),&#10;            verticalArrangement = Arrangement.spacedBy(8.dp)&#10;        ) {&#10;            GradientSlider(&#10;                label = &quot;Red&quot;,&#10;                value = red,&#10;                onValueChange = { red = it },&#10;                gradientColors = listOf(Color(0xFF1a0000), Color.Red)&#10;            )&#10;            GradientSlider(&#10;                label = &quot;Green&quot;,&#10;                value = green,&#10;                onValueChange = { green = it },&#10;                gradientColors = listOf(Color(0xFF001a00), AccentGreen)&#10;            )&#10;            GradientSlider(&#10;                label = &quot;Blue&quot;,&#10;                value = blue,&#10;                onValueChange = { blue = it },&#10;                gradientColors = listOf(Color(0xFF00001a), Color(0xFF3B82F6))&#10;            )&#10;            GradientSlider(&#10;                label = &quot;Brightness&quot;,&#10;                value = brightness,&#10;                onValueChange = { brightness = it },&#10;                gradientColors = listOf(Color(0xFF1a1a1a), Color.Yellow)&#10;            )&#10;        }&#10;&#10;        // Preset Palette Selector&#10;        Card(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .shadow(4.dp, RoundedCornerShape(12.dp)),&#10;            shape = RoundedCornerShape(12.dp),&#10;            colors = CardDefaults.cardColors(containerColor = CardBackground)&#10;        ) {&#10;            Column(modifier = Modifier.padding(12.dp)) {&#10;                Row(&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    horizontalArrangement = Arrangement.SpaceBetween,&#10;                    verticalAlignment = Alignment.CenterVertically&#10;                ) {&#10;                    Text(&#10;                        text = &quot; Color Presets&quot;,&#10;                        color = Color.White,&#10;                        fontWeight = FontWeight.Bold,&#10;                        fontSize = 14.sp&#10;                    )&#10;                    TextButton(&#10;                        onClick = { showPaletteSelector = !showPaletteSelector }&#10;                    ) {&#10;                        Text(&#10;                            text = if (showPaletteSelector) &quot;Hide ▲&quot; else &quot;Show ▼&quot;,&#10;                            color = AccentCyan,&#10;                            fontSize = 12.sp&#10;                        )&#10;                    }&#10;                }&#10;&#10;                if (showPaletteSelector) {&#10;                    Spacer(modifier = Modifier.height(8.dp))&#10;                    LazyRow(&#10;                        horizontalArrangement = Arrangement.spacedBy(8.dp)&#10;                    ) {&#10;                        items(presetPalettes) { palette -&gt;&#10;                            PresetPaletteItem(&#10;                                palette = palette,&#10;                                onClick = {&#10;                                    ledStates = palette.colors&#10;                                    // Update current sliders to match selected LED&#10;                                    val newState = ledStates[selectedLed]&#10;                                    red = newState.red.toFloat()&#10;                                    green = newState.green.toFloat()&#10;                                    blue = newState.blue.toFloat()&#10;                                    brightness = newState.brightness.toFloat()&#10;                                    // Send all colors to ESP32&#10;                                    onSendAllColors(ledStates)&#10;                                }&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        }&#10;&#10;        // Send Button with gradient&#10;        Button(&#10;            onClick = {&#10;                ledStates = ledStates.toMutableList().apply {&#10;                    this[selectedLed] = LedState(red.toInt(), green.toInt(), blue.toInt(), brightness.toInt())&#10;                }&#10;                onSendColor(selectedLed.toString(), red.toInt(), green.toInt(), blue.toInt(), brightness.toInt())&#10;            },&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .height(56.dp),&#10;            shape = RoundedCornerShape(16.dp),&#10;            colors = ButtonDefaults.buttonColors(containerColor = Color.Transparent)&#10;        ) {&#10;            Box(&#10;                modifier = Modifier&#10;                    .fillMaxSize()&#10;                    .background(&#10;                        Brush.linearGradient(&#10;                            colors = listOf(AccentCyan, AccentPurple, AccentPink)&#10;                        ),&#10;                        RoundedCornerShape(16.dp)&#10;                    ),&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                Row(&#10;                    verticalAlignment = Alignment.CenterVertically,&#10;                    horizontalArrangement = Arrangement.Center&#10;                ) {&#10;                    Icon(&#10;                        imageVector = Icons.AutoMirrored.Filled.Send,&#10;                        contentDescription = &quot;Send&quot;,&#10;                        tint = Color.White,&#10;                        modifier = Modifier.size(24.dp)&#10;                    )&#10;                    Spacer(modifier = Modifier.width(8.dp))&#10;                    Text(&#10;                        text = &quot;SEND TO LED $selectedLed&quot;,&#10;                        color = Color.White,&#10;                        fontWeight = FontWeight.Bold,&#10;                        fontSize = 16.sp&#10;                    )&#10;                }&#10;            }&#10;        }&#10;&#10;        Spacer(modifier = Modifier.height(32.dp))&#10;    }&#10;}&#10;&#10;@Composable&#10;fun PresetPaletteItem(&#10;    palette: ColorPalette,&#10;    onClick: () -&gt; Unit&#10;) {&#10;    Card(&#10;        modifier = Modifier&#10;            .width(80.dp)&#10;            .clickable { onClick() },&#10;        shape = RoundedCornerShape(12.dp),&#10;        colors = CardDefaults.cardColors(containerColor = Color(0xFF21262D))&#10;    ) {&#10;        Column(&#10;            modifier = Modifier.padding(8.dp),&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            Text(&#10;                text = palette.icon,&#10;                fontSize = 24.sp&#10;            )&#10;            Spacer(modifier = Modifier.height(4.dp))&#10;            Text(&#10;                text = palette.name,&#10;                color = Color.White,&#10;                fontSize = 10.sp,&#10;                fontWeight = FontWeight.Medium,&#10;                maxLines = 1&#10;            )&#10;            Spacer(modifier = Modifier.height(4.dp))&#10;            // Preview of palette colors&#10;            Row(&#10;                modifier = Modifier.fillMaxWidth(),&#10;                horizontalArrangement = Arrangement.SpaceEvenly&#10;            ) {&#10;                repeat(4) { i -&gt;&#10;                    val state = palette.colors[i * 6]&#10;                    Box(&#10;                        modifier = Modifier&#10;                            .size(12.dp)&#10;                            .background(&#10;                                Color(state.red, state.green, state.blue),&#10;                                CircleShape&#10;                            )&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun InfoChip(label: String, value: Int, color: Color) {&#10;    Column(&#10;        horizontalAlignment = Alignment.CenterHorizontally&#10;    ) {&#10;        Text(&#10;            text = label,&#10;            color = color,&#10;            fontWeight = FontWeight.Bold,&#10;            fontSize = 14.sp&#10;        )&#10;        Text(&#10;            text = &quot;$value&quot;,&#10;            color = Color.White,&#10;            fontWeight = FontWeight.Bold,&#10;            fontSize = 18.sp&#10;        )&#10;    }&#10;}&#10;&#10;@Composable&#10;fun GradientSlider(&#10;    label: String,&#10;    value: Float,&#10;    onValueChange: (Float) -&gt; Unit,&#10;    gradientColors: List&lt;Color&gt;&#10;) {&#10;    Column(modifier = Modifier.fillMaxWidth()) {&#10;        Row(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            horizontalArrangement = Arrangement.SpaceBetween&#10;        ) {&#10;            Text(&#10;                text = label,&#10;                style = MaterialTheme.typography.bodyMedium,&#10;                color = Color.White.copy(alpha = 0.8f)&#10;            )&#10;            Text(&#10;                text = &quot;${value.toInt()}&quot;,&#10;                style = MaterialTheme.typography.bodyMedium,&#10;                color = gradientColors.last(),&#10;                fontWeight = FontWeight.Bold&#10;            )&#10;        }&#10;        Spacer(modifier = Modifier.height(4.dp))&#10;        Box(modifier = Modifier.fillMaxWidth()) {&#10;            // Track background with gradient&#10;            Box(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .height(8.dp)&#10;                    .clip(RoundedCornerShape(4.dp))&#10;                    .background(&#10;                        Brush.horizontalGradient(gradientColors)&#10;                    )&#10;                    .align(Alignment.Center)&#10;            )&#10;            Slider(&#10;                value = value,&#10;                onValueChange = onValueChange,&#10;                valueRange = 0f..255f,&#10;                modifier = Modifier.fillMaxWidth(),&#10;                colors = SliderDefaults.colors(&#10;                    thumbColor = gradientColors.last(),&#10;                    activeTrackColor = Color.Transparent,&#10;                    inactiveTrackColor = Color.Transparent&#10;                )&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun CircularLedLayout(&#10;    ledCount: Int,&#10;    selectedLed: Int,&#10;    ledStates: List&lt;LedState&gt;,&#10;    onLedClick: (Int) -&gt; Unit&#10;) {&#10;    Layout(&#10;        content = {&#10;            repeat(ledCount) { index -&gt;&#10;                val state = ledStates[index]&#10;                val ledColor = Color(&#10;                    red = state.red,&#10;                    green = state.green,&#10;                    blue = state.blue,&#10;                    alpha = 255&#10;                )&#10;                val isSelected = index == selectedLed&#10;&#10;                // Animated scale for selected LED&#10;                val scale by animateFloatAsState(&#10;                    targetValue = if (isSelected) 1.2f else 1f,&#10;                    animationSpec = spring(&#10;                        dampingRatio = Spring.DampingRatioMediumBouncy,&#10;                        stiffness = Spring.StiffnessLow&#10;                    ),&#10;                    label = &quot;scale&quot;&#10;                )&#10;&#10;                val animatedColor by animateColorAsState(&#10;                    targetValue = ledColor,&#10;                    animationSpec = tween(300),&#10;                    label = &quot;color&quot;&#10;                )&#10;&#10;                Box(contentAlignment = Alignment.Center) {&#10;                    // Glow effect for each LED&#10;                    if (isSelected || (state.red + state.green + state.blue) &gt; 100) {&#10;                        Box(&#10;                            modifier = Modifier&#10;                                .size(40.dp)&#10;                                .blur(8.dp)&#10;                                .background(animatedColor.copy(alpha = 0.5f), CircleShape)&#10;                        )&#10;                    }&#10;                    Box(&#10;                        modifier = Modifier&#10;                            .size(32.dp)&#10;                            .scale(scale)&#10;                            .shadow(if (isSelected) 8.dp else 2.dp, CircleShape)&#10;                            .clip(CircleShape)&#10;                            .background(&#10;                                Brush.radialGradient(&#10;                                    colors = listOf(&#10;                                        animatedColor,&#10;                                        animatedColor.copy(alpha = 0.7f)&#10;                                    )&#10;                                )&#10;                            )&#10;                            .border(&#10;                                width = if (isSelected) 2.dp else 1.dp,&#10;                                brush = if (isSelected) Brush.linearGradient(&#10;                                    colors = listOf(AccentCyan, AccentPurple)&#10;                                ) else Brush.linearGradient(&#10;                                    colors = listOf(Color.White.copy(alpha = 0.3f), Color.White.copy(alpha = 0.1f))&#10;                                ),&#10;                                shape = CircleShape&#10;                            )&#10;                            .clickable(&#10;                                interactionSource = remember { MutableInteractionSource() },&#10;                                indication = null&#10;                            ) { onLedClick(index) },&#10;                        contentAlignment = Alignment.Center&#10;                    ) {&#10;                        Text(&#10;                            text = &quot;$index&quot;,&#10;                            fontSize = 10.sp,&#10;                            fontWeight = FontWeight.Bold,&#10;                            color = if ((state.red + state.green + state.blue) / 3 &gt; 128)&#10;                                Color.Black.copy(alpha = 0.8f) else Color.White&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    ) { measurables, constraints -&gt;&#10;        val placeables = measurables.map { it.measure(constraints) }&#10;        val radius = minOf(constraints.maxWidth, constraints.maxHeight) / 2 - 25&#10;        val centerX = constraints.maxWidth / 2&#10;        val centerY = constraints.maxHeight / 2&#10;&#10;        layout(constraints.maxWidth, constraints.maxHeight) {&#10;            placeables.forEachIndexed { index, placeable -&gt;&#10;                val angle = (2 * Math.PI * index / ledCount) - Math.PI / 2&#10;                val x = centerX + (radius * cos(angle)).toInt() - placeable.width / 2&#10;                val y = centerY + (radius * sin(angle)).toInt() - placeable.height / 2&#10;                placeable.placeRelative(x, y)&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.ledcontrol&#10;&#10;import android.content.Context&#10;import android.content.SharedPreferences&#10;import android.os.Bundle&#10;import android.util.Log&#10;import androidx.activity.ComponentActivity&#10;import androidx.activity.compose.setContent&#10;import androidx.activity.enableEdgeToEdge&#10;import androidx.compose.animation.animateColorAsState&#10;import androidx.compose.animation.core.*&#10;import androidx.compose.foundation.Canvas&#10;import androidx.compose.foundation.ExperimentalFoundationApi&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.border&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.combinedClickable&#10;import androidx.compose.foundation.interaction.MutableInteractionSource&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyRow&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.foundation.verticalScroll&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.filled.Send&#10;import androidx.compose.material.icons.filled.Delete&#10;import androidx.compose.material.icons.filled.Lightbulb&#10;import androidx.compose.material.icons.filled.Save&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.blur&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.draw.scale&#10;import androidx.compose.ui.draw.shadow&#10;import androidx.compose.ui.graphics.Brush&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.graphics.drawscope.Stroke&#10;import androidx.compose.ui.layout.Layout&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import androidx.compose.ui.window.Dialog&#10;import com.example.ledcontrol.ui.theme.LedControlTheme&#10;import com.google.gson.Gson&#10;import com.google.gson.reflect.TypeToken&#10;import org.eclipse.paho.client.mqttv3.*&#10;import org.eclipse.paho.client.mqttv3.persist.MemoryPersistence&#10;import java.util.UUID&#10;import kotlin.math.cos&#10;import kotlin.math.sin&#10;&#10;// MQTT Configuration&#10;const val MQTT_SERVER = &quot;ssl://76bf78e5731240cbb090e3284089c085.s1.eu.hivemq.cloud:8883&quot;&#10;const val MQTT_USER = &quot;hivemq.webclient.1765688353696&quot;&#10;const val MQTT_PASS = &quot;r8&gt;!lHMZ37RYzy?5&lt;Sxv&quot;&#10;const val TOPIC_PREFIX = &quot;esp32/controlled/&quot;&#10;&#10;// Beautiful color palette&#10;val DarkBackground = Color(0xFF0D1117)&#10;val CardBackground = Color(0xFF161B22)&#10;val AccentCyan = Color(0xFF00D9FF)&#10;val AccentPurple = Color(0xFF8B5CF6)&#10;val AccentPink = Color(0xFFEC4899)&#10;val AccentGreen = Color(0xFF10B981)&#10;&#10;// Data class for LED state&#10;data class LedState(&#10;    val red: Int,&#10;    val green: Int,&#10;    val blue: Int,&#10;    val brightness: Int&#10;)&#10;&#10;// Data class for color palette&#10;data class ColorPalette(&#10;    val name: String,&#10;    val icon: String,&#10;    val colors: List&lt;LedState&gt;,&#10;    val isCustom: Boolean = false&#10;)&#10;&#10;// Data class for serializable custom preset&#10;data class CustomPreset(&#10;    val id: String = UUID.randomUUID().toString(),&#10;    val name: String,&#10;    val icon: String,&#10;    val ledStates: List&lt;LedState&gt;,&#10;    val createdAt: Long = System.currentTimeMillis()&#10;)&#10;&#10;// Helper class to manage custom presets with SharedPreferences&#10;class PresetManager(context: Context) {&#10;    private val sharedPrefs: SharedPreferences =&#10;        context.getSharedPreferences(&quot;led_presets&quot;, Context.MODE_PRIVATE)&#10;    private val gson = Gson()&#10;    private val presetsKey = &quot;custom_presets&quot;&#10;&#10;    fun savePreset(preset: CustomPreset) {&#10;        val presets = getPresets().toMutableList()&#10;        presets.add(preset)&#10;        savePresetsList(presets)&#10;    }&#10;&#10;    fun deletePreset(presetId: String) {&#10;        val presets = getPresets().toMutableList()&#10;        presets.removeAll { it.id == presetId }&#10;        savePresetsList(presets)&#10;    }&#10;&#10;    fun getPresets(): List&lt;CustomPreset&gt; {&#10;        val json = sharedPrefs.getString(presetsKey, null) ?: return emptyList()&#10;        return try {&#10;            val type = object : TypeToken&lt;List&lt;CustomPreset&gt;&gt;() {}.type&#10;            gson.fromJson(json, type) ?: emptyList()&#10;        } catch (e: Exception) {&#10;            Log.e(&quot;PresetManager&quot;, &quot;Error loading presets: ${e.message}&quot;)&#10;            emptyList()&#10;        }&#10;    }&#10;&#10;    private fun savePresetsList(presets: List&lt;CustomPreset&gt;) {&#10;        val json = gson.toJson(presets)&#10;        sharedPrefs.edit().putString(presetsKey, json).apply()&#10;    }&#10;}&#10;&#10;// Helper function to convert HSV to RGB&#10;fun hsvToRgb(h: Float, s: Float, v: Float): Triple&lt;Int, Int, Int&gt; {&#10;    val c = v * s&#10;    val x = c * (1 - kotlin.math.abs((h / 60) % 2 - 1))&#10;    val m = v - c&#10;&#10;    val (r, g, b) = when {&#10;        h &lt; 60 -&gt; Triple(c, x, 0f)&#10;        h &lt; 120 -&gt; Triple(x, c, 0f)&#10;        h &lt; 180 -&gt; Triple(0f, c, x)&#10;        h &lt; 240 -&gt; Triple(0f, x, c)&#10;        h &lt; 300 -&gt; Triple(x, 0f, c)&#10;        else -&gt; Triple(c, 0f, x)&#10;    }&#10;&#10;    return Triple(&#10;        ((r + m) * 255).toInt().coerceIn(0, 255),&#10;        ((g + m) * 255).toInt().coerceIn(0, 255),&#10;        ((b + m) * 255).toInt().coerceIn(0, 255)&#10;    )&#10;}&#10;&#10;// Pre-set color palettes&#10;val presetPalettes = listOf(&#10;    ColorPalette(&#10;        name = &quot;Rainbow&quot;,&#10;        icon = &quot;&quot;,&#10;        colors = List(24) { index -&gt;&#10;            val hue = (index * 15f) % 360f&#10;            val rgb = hsvToRgb(hue, 1f, 1f)&#10;            LedState(rgb.first, rgb.second, rgb.third, 200)&#10;        }&#10;    ),&#10;    ColorPalette(&#10;        name = &quot;Ocean Wave&quot;,&#10;        icon = &quot;&quot;,&#10;        colors = List(24) { index -&gt;&#10;            val phase = (index * 15f) % 360f&#10;            val blue = (200 + 55 * sin(Math.toRadians(phase.toDouble()))).toInt()&#10;            val green = (100 + 100 * sin(Math.toRadians((phase + 60).toDouble()))).toInt()&#10;            LedState(0, green.coerceIn(0, 255), blue.coerceIn(0, 255), 180)&#10;        }&#10;    ),&#10;    ColorPalette(&#10;        name = &quot;Fire&quot;,&#10;        icon = &quot;&quot;,&#10;        colors = List(24) { index -&gt;&#10;            val phase = (index * 15f) % 360f&#10;            val red = 255&#10;            val green = (80 + 80 * sin(Math.toRadians(phase.toDouble()))).toInt()&#10;            LedState(red, green.coerceIn(0, 160), 0, 220)&#10;        }&#10;    ),&#10;    ColorPalette(&#10;        name = &quot;Aurora&quot;,&#10;        icon = &quot;✨&quot;,&#10;        colors = List(24) { index -&gt;&#10;            val phase = index * 15f&#10;            val green = (150 + 105 * sin(Math.toRadians(phase.toDouble()))).toInt()&#10;            val blue = (100 + 155 * cos(Math.toRadians(phase.toDouble()))).toInt()&#10;            val red = (50 + 50 * sin(Math.toRadians((phase * 2).toDouble()))).toInt()&#10;            LedState(red.coerceIn(0, 255), green.coerceIn(0, 255), blue.coerceIn(0, 255), 200)&#10;        }&#10;    ),&#10;    ColorPalette(&#10;        name = &quot;Sunset&quot;,&#10;        icon = &quot;&quot;,&#10;        colors = List(24) { index -&gt;&#10;            val phase = index * 15f&#10;            val red = 255&#10;            val green = (100 + 80 * sin(Math.toRadians(phase.toDouble()))).toInt()&#10;            val blue = (50 + 100 * cos(Math.toRadians((phase + 90).toDouble()))).toInt()&#10;            LedState(red, green.coerceIn(50, 180), blue.coerceIn(0, 150), 200)&#10;        }&#10;    ),&#10;    ColorPalette(&#10;        name = &quot;Christmas&quot;,&#10;        icon = &quot;&quot;,&#10;        colors = List(24) { index -&gt;&#10;            if (index % 2 == 0) LedState(255, 0, 0, 200) else LedState(0, 255, 0, 200)&#10;        }&#10;    ),&#10;    ColorPalette(&#10;        name = &quot;Party&quot;,&#10;        icon = &quot;&quot;,&#10;        colors = List(24) { index -&gt;&#10;            when (index % 4) {&#10;                0 -&gt; LedState(255, 0, 255, 220) // Magenta&#10;                1 -&gt; LedState(0, 255, 255, 220) // Cyan&#10;                2 -&gt; LedState(255, 255, 0, 220) // Yellow&#10;                else -&gt; LedState(255, 100, 0, 220) // Orange&#10;            }&#10;        }&#10;    ),&#10;    ColorPalette(&#10;        name = &quot;Cool White&quot;,&#10;        icon = &quot;❄️&quot;,&#10;        colors = List(24) { LedState(255, 255, 255, 180) }&#10;    ),&#10;    ColorPalette(&#10;        name = &quot;Warm White&quot;,&#10;        icon = &quot;&quot;,&#10;        colors = List(24) { LedState(255, 200, 150, 180) }&#10;    ),&#10;    ColorPalette(&#10;        name = &quot;All Off&quot;,&#10;        icon = &quot;⚫&quot;,&#10;        colors = List(24) { LedState(0, 0, 0, 0) }&#10;    )&#10;)&#10;&#10;class MainActivity : ComponentActivity() {&#10;    private lateinit var mqttClient: MqttClient&#10;&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        super.onCreate(savedInstanceState)&#10;        enableEdgeToEdge()&#10;&#10;        connectMqtt()&#10;&#10;        setContent {&#10;            LedControlTheme {&#10;                Surface(&#10;                    modifier = Modifier.fillMaxSize(),&#10;                    color = DarkBackground&#10;                ) {&#10;                    LedControlScreen(&#10;                        onSendColor = { ledId, r, g, b, brightness -&gt;&#10;                            publishColor(ledId, r, g, b, brightness)&#10;                        },&#10;                        onSendAllColors = { states -&gt;&#10;                            // Send all LED colors with a small delay between each&#10;                            Thread {&#10;                                states.forEachIndexed { index, state -&gt;&#10;                                    publishColor(index.toString(), state.red, state.green, state.blue, state.brightness)&#10;                                    Thread.sleep(50) // Small delay to prevent overwhelming MQTT&#10;                                }&#10;                            }.start()&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    private fun connectMqtt() {&#10;        Thread {&#10;            try {&#10;                val clientId = &quot;AndroidClient_${UUID.randomUUID()}&quot;&#10;                mqttClient = MqttClient(MQTT_SERVER, clientId, MemoryPersistence())&#10;&#10;                val options = MqttConnectOptions().apply {&#10;                    userName = MQTT_USER&#10;                    password = MQTT_PASS.toCharArray()&#10;                    isCleanSession = true&#10;                    connectionTimeout = 30&#10;                    keepAliveInterval = 60&#10;                }&#10;&#10;                mqttClient.connect(options)&#10;                Log.d(&quot;MQTT&quot;, &quot;Connected successfully!&quot;)&#10;            } catch (e: Exception) {&#10;                Log.e(&quot;MQTT&quot;, &quot;Connection failed: ${e.message}&quot;)&#10;            }&#10;        }.start()&#10;    }&#10;&#10;    private fun publishColor(ledId: String, r: Int, g: Int, b: Int, brightness: Int) {&#10;        Thread {&#10;            try {&#10;                if (::mqttClient.isInitialized &amp;&amp; mqttClient.isConnected) {&#10;                    val topic = &quot;$TOPIC_PREFIX$ledId&quot;&#10;                    val payload = &quot;$r,$g,$b,$brightness&quot;&#10;                    mqttClient.publish(topic, payload.toByteArray(), 1, false)&#10;                    Log.d(&quot;MQTT&quot;, &quot;Published to $topic: $payload&quot;)&#10;                }&#10;            } catch (e: Exception) {&#10;                Log.e(&quot;MQTT&quot;, &quot;Publish failed: ${e.message}&quot;)&#10;            }&#10;        }.start()&#10;    }&#10;&#10;    override fun onDestroy() {&#10;        super.onDestroy()&#10;        try {&#10;            if (::mqttClient.isInitialized &amp;&amp; mqttClient.isConnected) {&#10;                mqttClient.disconnect()&#10;            }&#10;        } catch (e: Exception) {&#10;            Log.e(&quot;MQTT&quot;, &quot;Disconnect failed: ${e.message}&quot;)&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun LedControlScreen(&#10;    modifier: Modifier = Modifier,&#10;    onSendColor: (String, Int, Int, Int, Int) -&gt; Unit,&#10;    onSendAllColors: (List&lt;LedState&gt;) -&gt; Unit&#10;) {&#10;    val context = LocalContext.current&#10;    val presetManager = remember { PresetManager(context) }&#10;&#10;    var selectedLed by remember { mutableStateOf(0) }&#10;    var ledStates by remember { mutableStateOf(List(24) { LedState(255, 100, 50, 200) }) }&#10;    var red by remember { mutableStateOf(255f) }&#10;    var green by remember { mutableStateOf(100f) }&#10;    var blue by remember { mutableStateOf(50f) }&#10;    var brightness by remember { mutableStateOf(200f) }&#10;    var showPaletteSelector by remember { mutableStateOf(false) }&#10;&#10;    // Custom preset states&#10;    var customPresets by remember { mutableStateOf(presetManager.getPresets()) }&#10;    var showSaveDialog by remember { mutableStateOf(false) }&#10;    var showDeleteConfirmDialog by remember { mutableStateOf&lt;CustomPreset?&gt;(null) }&#10;    &#10;    // Global brightness mode - when true, brightness slider affects all LEDs&#10;    var globalBrightnessMode by remember { mutableStateOf(false) }&#10;    var globalBrightness by remember { mutableStateOf(200f) }&#10;&#10;    // Preview color with animation&#10;    val previewColor = Color(&#10;        red = red.toInt(),&#10;        green = green.toInt(),&#10;        blue = blue.toInt(),&#10;        alpha = 255&#10;    )&#10;&#10;    // Animated glow effect&#10;    val infiniteTransition = rememberInfiniteTransition(label = &quot;glow&quot;)&#10;    val glowAlpha by infiniteTransition.animateFloat(&#10;        initialValue = 0.5f,&#10;        targetValue = 1f,&#10;        animationSpec = infiniteRepeatable(&#10;            animation = tween(1000, easing = FastOutSlowInEasing),&#10;            repeatMode = RepeatMode.Reverse&#10;        ),&#10;        label = &quot;glowAlpha&quot;&#10;    )&#10;&#10;    Column(&#10;        modifier = modifier&#10;            .fillMaxSize()&#10;            .verticalScroll(rememberScrollState())&#10;            .padding(16.dp)&#10;            .padding(top = 32.dp),&#10;        horizontalAlignment = Alignment.CenterHorizontally,&#10;        verticalArrangement = Arrangement.spacedBy(16.dp)&#10;    ) {&#10;        // Title with gradient&#10;        Text(&#10;            text = &quot;✨ LED Controller&quot;,&#10;            style = MaterialTheme.typography.headlineMedium.copy(&#10;                fontWeight = FontWeight.Bold,&#10;                brush = Brush.linearGradient(&#10;                    colors = listOf(AccentCyan, AccentPurple, AccentPink)&#10;                )&#10;            )&#10;        )&#10;&#10;        // Circular LED Ring with glow effect&#10;        Box(&#10;            modifier = Modifier.size(280.dp),&#10;            contentAlignment = Alignment.Center&#10;        ) {&#10;            // Background glow&#10;            Canvas(modifier = Modifier.size(280.dp)) {&#10;                drawCircle(&#10;                    brush = Brush.radialGradient(&#10;                        colors = listOf(&#10;                            previewColor.copy(alpha = glowAlpha * 0.5f),&#10;                            Color.Transparent&#10;                        )&#10;                    ),&#10;                    radius = size.minDimension / 2&#10;                )&#10;            }&#10;&#10;            // Decorative ring&#10;            Canvas(modifier = Modifier.size(260.dp)) {&#10;                drawCircle(&#10;                    brush = Brush.sweepGradient(&#10;                        colors = listOf(&#10;                            AccentCyan.copy(alpha = 0.3f),&#10;                            AccentPurple.copy(alpha = 0.3f),&#10;                            AccentPink.copy(alpha = 0.3f),&#10;                            AccentCyan.copy(alpha = 0.3f)&#10;                        )&#10;                    ),&#10;                    style = Stroke(width = 2.dp.toPx())&#10;                )&#10;            }&#10;&#10;            CircularLedLayout(&#10;                ledCount = 24,&#10;                selectedLed = selectedLed,&#10;                ledStates = ledStates,&#10;                onLedClick = { index -&gt;&#10;                    ledStates = ledStates.toMutableList().apply {&#10;                        this[selectedLed] = LedState(red.toInt(), green.toInt(), blue.toInt(), brightness.toInt())&#10;                    }&#10;                    selectedLed = index&#10;                    val newState = ledStates[index]&#10;                    red = newState.red.toFloat()&#10;                    green = newState.green.toFloat()&#10;                    blue = newState.blue.toFloat()&#10;                    brightness = newState.brightness.toFloat()&#10;                }&#10;            )&#10;&#10;            // Center preview with glow&#10;            Box(contentAlignment = Alignment.Center) {&#10;                // Glow behind preview&#10;                Box(&#10;                    modifier = Modifier&#10;                        .size(100.dp)&#10;                        .blur(20.dp)&#10;                        .background(previewColor.copy(alpha = glowAlpha), CircleShape)&#10;                )&#10;                // Main preview circle&#10;                Box(&#10;                    modifier = Modifier&#10;                        .size(90.dp)&#10;                        .shadow(8.dp, CircleShape)&#10;                        .clip(CircleShape)&#10;                        .background(&#10;                            Brush.radialGradient(&#10;                                colors = listOf(&#10;                                    previewColor,&#10;                                    previewColor.copy(alpha = 0.8f)&#10;                                )&#10;                            )&#10;                        )&#10;                        .border(3.dp, Color.White.copy(alpha = 0.3f), CircleShape),&#10;                    contentAlignment = Alignment.Center&#10;                ) {&#10;                    Column(horizontalAlignment = Alignment.CenterHorizontally) {&#10;                        Icon(&#10;                            imageVector = Icons.Filled.Lightbulb,&#10;                            contentDescription = &quot;LED&quot;,&#10;                            tint = if ((red + green + blue) / 3 &gt; 128) Color.Black.copy(alpha = 0.7f) else Color.White,&#10;                            modifier = Modifier.size(32.dp)&#10;                        )&#10;                        Text(&#10;                            text = &quot;LED $selectedLed&quot;,&#10;                            fontSize = 12.sp,&#10;                            fontWeight = FontWeight.Bold,&#10;                            color = if ((red + green + blue) / 3 &gt; 128) Color.Black.copy(alpha = 0.8f) else Color.White&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        }&#10;&#10;        // Info Card with glassmorphism effect&#10;        Card(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .shadow(8.dp, RoundedCornerShape(16.dp)),&#10;            shape = RoundedCornerShape(16.dp),&#10;            colors = CardDefaults.cardColors(containerColor = CardBackground)&#10;        ) {&#10;            Row(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .padding(16.dp),&#10;                horizontalArrangement = Arrangement.SpaceEvenly,&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                InfoChip(label = &quot;R&quot;, value = red.toInt(), color = Color.Red)&#10;                InfoChip(label = &quot;G&quot;, value = green.toInt(), color = AccentGreen)&#10;                InfoChip(label = &quot;B&quot;, value = blue.toInt(), color = Color(0xFF3B82F6))&#10;                InfoChip(label = &quot;☀&quot;, value = brightness.toInt(), color = Color.Yellow)&#10;            }&#10;        }&#10;&#10;        // Sliders with beautiful design&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .background(CardBackground, RoundedCornerShape(16.dp))&#10;                .padding(16.dp),&#10;            verticalArrangement = Arrangement.spacedBy(8.dp)&#10;        ) {&#10;            GradientSlider(&#10;                label = &quot;Red&quot;,&#10;                value = red,&#10;                onValueChange = { red = it },&#10;                gradientColors = listOf(Color(0xFF1a0000), Color.Red)&#10;            )&#10;            GradientSlider(&#10;                label = &quot;Green&quot;,&#10;                value = green,&#10;                onValueChange = { green = it },&#10;                gradientColors = listOf(Color(0xFF001a00), AccentGreen)&#10;            )&#10;            GradientSlider(&#10;                label = &quot;Blue&quot;,&#10;                value = blue,&#10;                onValueChange = { blue = it },&#10;                gradientColors = listOf(Color(0xFF00001a), Color(0xFF3B82F6))&#10;            )&#10;            &#10;            HorizontalDivider(&#10;                modifier = Modifier.padding(vertical = 8.dp),&#10;                color = Color.White.copy(alpha = 0.1f)&#10;            )&#10;            &#10;            // Global Brightness Mode Toggle&#10;            Row(&#10;                modifier = Modifier.fillMaxWidth(),&#10;                horizontalArrangement = Arrangement.SpaceBetween,&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                Row(verticalAlignment = Alignment.CenterVertically) {&#10;                    Text(&#10;                        text = &quot;☀️ &quot;,&#10;                        fontSize = 16.sp&#10;                    )&#10;                    Text(&#10;                        text = if (globalBrightnessMode) &quot;All LEDs Brightness&quot; else &quot;LED $selectedLed Brightness&quot;,&#10;                        color = Color.White,&#10;                        fontWeight = FontWeight.Medium,&#10;                        fontSize = 14.sp&#10;                    )&#10;                }&#10;                Row(verticalAlignment = Alignment.CenterVertically) {&#10;                    Text(&#10;                        text = &quot;All&quot;,&#10;                        color = if (globalBrightnessMode) AccentCyan else Color.White.copy(alpha = 0.5f),&#10;                        fontSize = 12.sp&#10;                    )&#10;                    Switch(&#10;                        checked = globalBrightnessMode,&#10;                        onCheckedChange = { &#10;                            globalBrightnessMode = it&#10;                            if (it) {&#10;                                // When switching to global mode, use current brightness as global&#10;                                globalBrightness = brightness&#10;                            }&#10;                        },&#10;                        colors = SwitchDefaults.colors(&#10;                            checkedThumbColor = AccentCyan,&#10;                            checkedTrackColor = AccentCyan.copy(alpha = 0.5f),&#10;                            uncheckedThumbColor = Color.Gray,&#10;                            uncheckedTrackColor = Color.Gray.copy(alpha = 0.3f)&#10;                        ),&#10;                        modifier = Modifier.padding(horizontal = 8.dp)&#10;                    )&#10;                }&#10;            }&#10;            &#10;            // Brightness Slider - behavior depends on globalBrightnessMode&#10;            if (globalBrightnessMode) {&#10;                GradientSlider(&#10;                    label = &quot;Global Brightness&quot;,&#10;                    value = globalBrightness,&#10;                    onValueChange = { newBrightness -&gt;&#10;                        globalBrightness = newBrightness&#10;                        // Update all LEDs brightness in real-time&#10;                        ledStates = ledStates.map { state -&gt;&#10;                            state.copy(brightness = newBrightness.toInt())&#10;                        }&#10;                        brightness = newBrightness&#10;                    },&#10;                    gradientColors = listOf(Color(0xFF1a1a1a), Color.Yellow)&#10;                )&#10;                &#10;                // Apply to All button for global brightness&#10;                Button(&#10;                    onClick = {&#10;                        // Send all LED colors with the new global brightness&#10;                        onSendAllColors(ledStates)&#10;                    },&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .padding(top = 8.dp),&#10;                    colors = ButtonDefaults.buttonColors(&#10;                        containerColor = Color.Yellow.copy(alpha = 0.2f)&#10;                    ),&#10;                    shape = RoundedCornerShape(8.dp)&#10;                ) {&#10;                    Text(&#10;                        text = &quot;☀️ Apply Brightness to All LEDs&quot;,&#10;                        color = Color.Yellow,&#10;                        fontWeight = FontWeight.Medium&#10;                    )&#10;                }&#10;            } else {&#10;                GradientSlider(&#10;                    label = &quot;Brightness&quot;,&#10;                    value = brightness,&#10;                    onValueChange = { brightness = it },&#10;                    gradientColors = listOf(Color(0xFF1a1a1a), Color.Yellow)&#10;                )&#10;            }&#10;        }&#10;&#10;        // Preset Palette Selector&#10;        Card(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .shadow(4.dp, RoundedCornerShape(12.dp)),&#10;            shape = RoundedCornerShape(12.dp),&#10;            colors = CardDefaults.cardColors(containerColor = CardBackground)&#10;        ) {&#10;            Column(modifier = Modifier.padding(12.dp)) {&#10;                Row(&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    horizontalArrangement = Arrangement.SpaceBetween,&#10;                    verticalAlignment = Alignment.CenterVertically&#10;                ) {&#10;                    Text(&#10;                        text = &quot; Color Presets&quot;,&#10;                        color = Color.White,&#10;                        fontWeight = FontWeight.Bold,&#10;                        fontSize = 14.sp&#10;                    )&#10;                    Row {&#10;                        // Save current state button&#10;                        IconButton(&#10;                            onClick = { showSaveDialog = true }&#10;                        ) {&#10;                            Icon(&#10;                                imageVector = Icons.Filled.Save,&#10;                                contentDescription = &quot;Save Preset&quot;,&#10;                                tint = AccentGreen&#10;                            )&#10;                        }&#10;                        TextButton(&#10;                            onClick = { showPaletteSelector = !showPaletteSelector }&#10;                        ) {&#10;                            Text(&#10;                                text = if (showPaletteSelector) &quot;Hide ▲&quot; else &quot;Show ▼&quot;,&#10;                                color = AccentCyan,&#10;                                fontSize = 12.sp&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;&#10;                if (showPaletteSelector) {&#10;                    // Custom Presets Section&#10;                    if (customPresets.isNotEmpty()) {&#10;                        Spacer(modifier = Modifier.height(8.dp))&#10;                        Text(&#10;                            text = &quot; My Presets&quot;,&#10;                            color = Color.White.copy(alpha = 0.7f),&#10;                            fontSize = 12.sp,&#10;                            fontWeight = FontWeight.Medium&#10;                        )&#10;                        Spacer(modifier = Modifier.height(4.dp))&#10;                        LazyRow(&#10;                            horizontalArrangement = Arrangement.spacedBy(8.dp)&#10;                        ) {&#10;                            items(customPresets, key = { it.id }) { preset -&gt;&#10;                                CustomPresetItem(&#10;                                    preset = preset,&#10;                                    onClick = {&#10;                                        ledStates = preset.ledStates&#10;                                        val newState = ledStates[selectedLed]&#10;                                        red = newState.red.toFloat()&#10;                                        green = newState.green.toFloat()&#10;                                        blue = newState.blue.toFloat()&#10;                                        brightness = newState.brightness.toFloat()&#10;                                        onSendAllColors(ledStates)&#10;                                    },&#10;                                    onLongClick = {&#10;                                        showDeleteConfirmDialog = preset&#10;                                    }&#10;                                )&#10;                            }&#10;                        }&#10;                        Spacer(modifier = Modifier.height(8.dp))&#10;                        HorizontalDivider(color = Color.White.copy(alpha = 0.1f))&#10;                    }&#10;&#10;                    // Built-in Presets Section&#10;                    Spacer(modifier = Modifier.height(8.dp))&#10;                    Text(&#10;                        text = &quot; Built-in Presets&quot;,&#10;                        color = Color.White.copy(alpha = 0.7f),&#10;                        fontSize = 12.sp,&#10;                        fontWeight = FontWeight.Medium&#10;                    )&#10;                    Spacer(modifier = Modifier.height(4.dp))&#10;                    LazyRow(&#10;                        horizontalArrangement = Arrangement.spacedBy(8.dp)&#10;                    ) {&#10;                        items(presetPalettes) { palette -&gt;&#10;                            PresetPaletteItem(&#10;                                palette = palette,&#10;                                onClick = {&#10;                                    ledStates = palette.colors&#10;                                    // Update current sliders to match selected LED&#10;                                    val newState = ledStates[selectedLed]&#10;                                    red = newState.red.toFloat()&#10;                                    green = newState.green.toFloat()&#10;                                    blue = newState.blue.toFloat()&#10;                                    brightness = newState.brightness.toFloat()&#10;                                    // Send all colors to ESP32&#10;                                    onSendAllColors(ledStates)&#10;                                }&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        }&#10;&#10;        // Send Button with gradient&#10;        Button(&#10;            onClick = {&#10;                ledStates = ledStates.toMutableList().apply {&#10;                    this[selectedLed] = LedState(red.toInt(), green.toInt(), blue.toInt(), brightness.toInt())&#10;                }&#10;                onSendColor(selectedLed.toString(), red.toInt(), green.toInt(), blue.toInt(), brightness.toInt())&#10;            },&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .height(56.dp),&#10;            shape = RoundedCornerShape(16.dp),&#10;            colors = ButtonDefaults.buttonColors(containerColor = Color.Transparent)&#10;        ) {&#10;            Box(&#10;                modifier = Modifier&#10;                    .fillMaxSize()&#10;                    .background(&#10;                        Brush.linearGradient(&#10;                            colors = listOf(AccentCyan, AccentPurple, AccentPink)&#10;                        ),&#10;                        RoundedCornerShape(16.dp)&#10;                    ),&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                Row(&#10;                    verticalAlignment = Alignment.CenterVertically,&#10;                    horizontalArrangement = Arrangement.Center&#10;                ) {&#10;                    Icon(&#10;                        imageVector = Icons.AutoMirrored.Filled.Send,&#10;                        contentDescription = &quot;Send&quot;,&#10;                        tint = Color.White,&#10;                        modifier = Modifier.size(24.dp)&#10;                    )&#10;                    Spacer(modifier = Modifier.width(8.dp))&#10;                    Text(&#10;                        text = &quot;SEND TO LED $selectedLed&quot;,&#10;                        color = Color.White,&#10;                        fontWeight = FontWeight.Bold,&#10;                        fontSize = 16.sp&#10;                    )&#10;                }&#10;            }&#10;        }&#10;&#10;        Spacer(modifier = Modifier.height(32.dp))&#10;    }&#10;&#10;    // Save Preset Dialog&#10;    if (showSaveDialog) {&#10;        SavePresetDialog(&#10;            onDismiss = { showSaveDialog = false },&#10;            onSave = { name, icon -&gt;&#10;                // Update current LED state before saving&#10;                val updatedStates = ledStates.toMutableList().apply {&#10;                    this[selectedLed] = LedState(red.toInt(), green.toInt(), blue.toInt(), brightness.toInt())&#10;                }&#10;                ledStates = updatedStates&#10;&#10;                val preset = CustomPreset(&#10;                    name = name,&#10;                    icon = icon,&#10;                    ledStates = updatedStates&#10;                )&#10;                presetManager.savePreset(preset)&#10;                customPresets = presetManager.getPresets()&#10;                showSaveDialog = false&#10;            }&#10;        )&#10;    }&#10;&#10;    // Delete Confirmation Dialog&#10;    showDeleteConfirmDialog?.let { preset -&gt;&#10;        DeletePresetDialog(&#10;            presetName = preset.name,&#10;            onDismiss = { showDeleteConfirmDialog = null },&#10;            onConfirm = {&#10;                presetManager.deletePreset(preset.id)&#10;                customPresets = presetManager.getPresets()&#10;                showDeleteConfirmDialog = null&#10;            }&#10;        )&#10;    }&#10;}&#10;&#10;@Composable&#10;fun PresetPaletteItem(&#10;    palette: ColorPalette,&#10;    onClick: () -&gt; Unit&#10;) {&#10;    Card(&#10;        modifier = Modifier&#10;            .width(80.dp)&#10;            .clickable { onClick() },&#10;        shape = RoundedCornerShape(12.dp),&#10;        colors = CardDefaults.cardColors(containerColor = Color(0xFF21262D))&#10;    ) {&#10;        Column(&#10;            modifier = Modifier.padding(8.dp),&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            Text(&#10;                text = palette.icon,&#10;                fontSize = 24.sp&#10;            )&#10;            Spacer(modifier = Modifier.height(4.dp))&#10;            Text(&#10;                text = palette.name,&#10;                color = Color.White,&#10;                fontSize = 10.sp,&#10;                fontWeight = FontWeight.Medium,&#10;                maxLines = 1&#10;            )&#10;            Spacer(modifier = Modifier.height(4.dp))&#10;            // Preview of palette colors&#10;            Row(&#10;                modifier = Modifier.fillMaxWidth(),&#10;                horizontalArrangement = Arrangement.SpaceEvenly&#10;            ) {&#10;                repeat(4) { i -&gt;&#10;                    val state = palette.colors[i * 6]&#10;                    Box(&#10;                        modifier = Modifier&#10;                            .size(12.dp)&#10;                            .background(&#10;                                Color(state.red, state.green, state.blue),&#10;                                CircleShape&#10;                            )&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@OptIn(ExperimentalFoundationApi::class)&#10;@Composable&#10;fun CustomPresetItem(&#10;    preset: CustomPreset,&#10;    onClick: () -&gt; Unit,&#10;    onLongClick: () -&gt; Unit&#10;) {&#10;    Card(&#10;        modifier = Modifier&#10;            .width(80.dp)&#10;            .combinedClickable(&#10;                onClick = onClick,&#10;                onLongClick = onLongClick&#10;            ),&#10;        shape = RoundedCornerShape(12.dp),&#10;        colors = CardDefaults.cardColors(containerColor = Color(0xFF21262D))&#10;    ) {&#10;        Column(&#10;            modifier = Modifier.padding(8.dp),&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            Text(&#10;                text = preset.icon,&#10;                fontSize = 24.sp&#10;            )&#10;            Spacer(modifier = Modifier.height(4.dp))&#10;            Text(&#10;                text = preset.name,&#10;                color = Color.White,&#10;                fontSize = 10.sp,&#10;                fontWeight = FontWeight.Medium,&#10;                maxLines = 1&#10;            )&#10;            Spacer(modifier = Modifier.height(4.dp))&#10;            // Preview of preset colors&#10;            Row(&#10;                modifier = Modifier.fillMaxWidth(),&#10;                horizontalArrangement = Arrangement.SpaceEvenly&#10;            ) {&#10;                repeat(4) { i -&gt;&#10;                    val state = preset.ledStates[i * 6]&#10;                    Box(&#10;                        modifier = Modifier&#10;                            .size(12.dp)&#10;                            .background(&#10;                                Color(state.red, state.green, state.blue),&#10;                                CircleShape&#10;                            )&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun SavePresetDialog(&#10;    onDismiss: () -&gt; Unit,&#10;    onSave: (name: String, icon: String) -&gt; Unit&#10;) {&#10;    var presetName by remember { mutableStateOf(&quot;&quot;) }&#10;    var selectedIcon by remember { mutableStateOf(&quot;&quot;) }&#10;&#10;    val iconOptions = listOf(&quot;&quot;, &quot;⭐&quot;, &quot;❤️&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;)&#10;&#10;    Dialog(onDismissRequest = onDismiss) {&#10;        Card(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(16.dp),&#10;            shape = RoundedCornerShape(16.dp),&#10;            colors = CardDefaults.cardColors(containerColor = CardBackground)&#10;        ) {&#10;            Column(&#10;                modifier = Modifier.padding(20.dp),&#10;                horizontalAlignment = Alignment.CenterHorizontally&#10;            ) {&#10;                Text(&#10;                    text = &quot;Save Current State&quot;,&#10;                    color = Color.White,&#10;                    fontWeight = FontWeight.Bold,&#10;                    fontSize = 18.sp&#10;                )&#10;&#10;                Spacer(modifier = Modifier.height(16.dp))&#10;&#10;                // Icon selector&#10;                Text(&#10;                    text = &quot;Choose an icon&quot;,&#10;                    color = Color.White.copy(alpha = 0.7f),&#10;                    fontSize = 12.sp&#10;                )&#10;                Spacer(modifier = Modifier.height(8.dp))&#10;                LazyRow(&#10;                    horizontalArrangement = Arrangement.spacedBy(8.dp)&#10;                ) {&#10;                    items(iconOptions) { icon -&gt;&#10;                        Box(&#10;                            modifier = Modifier&#10;                                .size(40.dp)&#10;                                .background(&#10;                                    if (icon == selectedIcon) AccentPurple.copy(alpha = 0.3f)&#10;                                    else Color.Transparent,&#10;                                    CircleShape&#10;                                )&#10;                                .border(&#10;                                    width = if (icon == selectedIcon) 2.dp else 0.dp,&#10;                                    color = if (icon == selectedIcon) AccentPurple else Color.Transparent,&#10;                                    shape = CircleShape&#10;                                )&#10;                                .clickable { selectedIcon = icon },&#10;                            contentAlignment = Alignment.Center&#10;                        ) {&#10;                            Text(text = icon, fontSize = 20.sp)&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(16.dp))&#10;&#10;                // Name input&#10;                OutlinedTextField(&#10;                    value = presetName,&#10;                    onValueChange = { presetName = it },&#10;                    label = { Text(&quot;Preset Name&quot;, color = Color.White.copy(alpha = 0.7f)) },&#10;                    singleLine = true,&#10;                    colors = OutlinedTextFieldDefaults.colors(&#10;                        focusedBorderColor = AccentCyan,&#10;                        unfocusedBorderColor = Color.White.copy(alpha = 0.3f),&#10;                        focusedTextColor = Color.White,&#10;                        unfocusedTextColor = Color.White,&#10;                        cursorColor = AccentCyan&#10;                    ),&#10;                    modifier = Modifier.fillMaxWidth()&#10;                )&#10;&#10;                Spacer(modifier = Modifier.height(20.dp))&#10;&#10;                // Buttons&#10;                Row(&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    horizontalArrangement = Arrangement.spacedBy(12.dp)&#10;                ) {&#10;                    OutlinedButton(&#10;                        onClick = onDismiss,&#10;                        modifier = Modifier.weight(1f),&#10;                        colors = ButtonDefaults.outlinedButtonColors(&#10;                            contentColor = Color.White&#10;                        )&#10;                    ) {&#10;                        Text(&quot;Cancel&quot;)&#10;                    }&#10;                    Button(&#10;                        onClick = {&#10;                            if (presetName.isNotBlank()) {&#10;                                onSave(presetName.trim(), selectedIcon)&#10;                            }&#10;                        },&#10;                        modifier = Modifier.weight(1f),&#10;                        enabled = presetName.isNotBlank(),&#10;                        colors = ButtonDefaults.buttonColors(&#10;                            containerColor = AccentGreen,&#10;                            contentColor = Color.White&#10;                        )&#10;                    ) {&#10;                        Icon(&#10;                            imageVector = Icons.Filled.Save,&#10;                            contentDescription = null,&#10;                            modifier = Modifier.size(16.dp)&#10;                        )&#10;                        Spacer(modifier = Modifier.width(4.dp))&#10;                        Text(&quot;Save&quot;)&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun DeletePresetDialog(&#10;    presetName: String,&#10;    onDismiss: () -&gt; Unit,&#10;    onConfirm: () -&gt; Unit&#10;) {&#10;    Dialog(onDismissRequest = onDismiss) {&#10;        Card(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(16.dp),&#10;            shape = RoundedCornerShape(16.dp),&#10;            colors = CardDefaults.cardColors(containerColor = CardBackground)&#10;        ) {&#10;            Column(&#10;                modifier = Modifier.padding(20.dp),&#10;                horizontalAlignment = Alignment.CenterHorizontally&#10;            ) {&#10;                Icon(&#10;                    imageVector = Icons.Filled.Delete,&#10;                    contentDescription = null,&#10;                    tint = AccentPink,&#10;                    modifier = Modifier.size(48.dp)&#10;                )&#10;&#10;                Spacer(modifier = Modifier.height(16.dp))&#10;&#10;                Text(&#10;                    text = &quot;Delete Preset?&quot;,&#10;                    color = Color.White,&#10;                    fontWeight = FontWeight.Bold,&#10;                    fontSize = 18.sp&#10;                )&#10;&#10;                Spacer(modifier = Modifier.height(8.dp))&#10;&#10;                Text(&#10;                    text = &quot;Are you sure you want to delete \&quot;$presetName\&quot;?&quot;,&#10;                    color = Color.White.copy(alpha = 0.7f),&#10;                    fontSize = 14.sp&#10;                )&#10;&#10;                Spacer(modifier = Modifier.height(20.dp))&#10;&#10;                Row(&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    horizontalArrangement = Arrangement.spacedBy(12.dp)&#10;                ) {&#10;                    OutlinedButton(&#10;                        onClick = onDismiss,&#10;                        modifier = Modifier.weight(1f),&#10;                        colors = ButtonDefaults.outlinedButtonColors(&#10;                            contentColor = Color.White&#10;                        )&#10;                    ) {&#10;                        Text(&quot;Cancel&quot;)&#10;                    }&#10;                    Button(&#10;                        onClick = onConfirm,&#10;                        modifier = Modifier.weight(1f),&#10;                        colors = ButtonDefaults.buttonColors(&#10;                            containerColor = AccentPink,&#10;                            contentColor = Color.White&#10;                        )&#10;                    ) {&#10;                        Icon(&#10;                            imageVector = Icons.Filled.Delete,&#10;                            contentDescription = null,&#10;                            modifier = Modifier.size(16.dp)&#10;                        )&#10;                        Spacer(modifier = Modifier.width(4.dp))&#10;                        Text(&quot;Delete&quot;)&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun InfoChip(label: String, value: Int, color: Color) {&#10;    Column(&#10;        horizontalAlignment = Alignment.CenterHorizontally&#10;    ) {&#10;        Text(&#10;            text = label,&#10;            color = color,&#10;            fontWeight = FontWeight.Bold,&#10;            fontSize = 14.sp&#10;        )&#10;        Text(&#10;            text = &quot;$value&quot;,&#10;            color = Color.White,&#10;            fontWeight = FontWeight.Bold,&#10;            fontSize = 18.sp&#10;        )&#10;    }&#10;}&#10;&#10;@Composable&#10;fun GradientSlider(&#10;    label: String,&#10;    value: Float,&#10;    onValueChange: (Float) -&gt; Unit,&#10;    gradientColors: List&lt;Color&gt;&#10;) {&#10;    Column(modifier = Modifier.fillMaxWidth()) {&#10;        Row(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            horizontalArrangement = Arrangement.SpaceBetween&#10;        ) {&#10;            Text(&#10;                text = label,&#10;                style = MaterialTheme.typography.bodyMedium,&#10;                color = Color.White.copy(alpha = 0.8f)&#10;            )&#10;            Text(&#10;                text = &quot;${value.toInt()}&quot;,&#10;                style = MaterialTheme.typography.bodyMedium,&#10;                color = gradientColors.last(),&#10;                fontWeight = FontWeight.Bold&#10;            )&#10;        }&#10;        Spacer(modifier = Modifier.height(4.dp))&#10;        Box(modifier = Modifier.fillMaxWidth()) {&#10;            // Track background with gradient&#10;            Box(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .height(8.dp)&#10;                    .clip(RoundedCornerShape(4.dp))&#10;                    .background(&#10;                        Brush.horizontalGradient(gradientColors)&#10;                    )&#10;                    .align(Alignment.Center)&#10;            )&#10;            Slider(&#10;                value = value,&#10;                onValueChange = onValueChange,&#10;                valueRange = 0f..255f,&#10;                modifier = Modifier.fillMaxWidth(),&#10;                colors = SliderDefaults.colors(&#10;                    thumbColor = gradientColors.last(),&#10;                    activeTrackColor = Color.Transparent,&#10;                    inactiveTrackColor = Color.Transparent&#10;                )&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun CircularLedLayout(&#10;    ledCount: Int,&#10;    selectedLed: Int,&#10;    ledStates: List&lt;LedState&gt;,&#10;    onLedClick: (Int) -&gt; Unit&#10;) {&#10;    Layout(&#10;        content = {&#10;            repeat(ledCount) { index -&gt;&#10;                val state = ledStates[index]&#10;                val ledColor = Color(&#10;                    red = state.red,&#10;                    green = state.green,&#10;                    blue = state.blue,&#10;                    alpha = 255&#10;                )&#10;                val isSelected = index == selectedLed&#10;&#10;                // Animated scale for selected LED&#10;                val scale by animateFloatAsState(&#10;                    targetValue = if (isSelected) 1.2f else 1f,&#10;                    animationSpec = spring(&#10;                        dampingRatio = Spring.DampingRatioMediumBouncy,&#10;                        stiffness = Spring.StiffnessLow&#10;                    ),&#10;                    label = &quot;scale&quot;&#10;                )&#10;&#10;                val animatedColor by animateColorAsState(&#10;                    targetValue = ledColor,&#10;                    animationSpec = tween(300),&#10;                    label = &quot;color&quot;&#10;                )&#10;&#10;                Box(contentAlignment = Alignment.Center) {&#10;                    // Glow effect for each LED&#10;                    if (isSelected || (state.red + state.green + state.blue) &gt; 100) {&#10;                        Box(&#10;                            modifier = Modifier&#10;                                .size(40.dp)&#10;                                .blur(8.dp)&#10;                                .background(animatedColor.copy(alpha = 0.5f), CircleShape)&#10;                        )&#10;                    }&#10;                    Box(&#10;                        modifier = Modifier&#10;                            .size(32.dp)&#10;                            .scale(scale)&#10;                            .shadow(if (isSelected) 8.dp else 2.dp, CircleShape)&#10;                            .clip(CircleShape)&#10;                            .background(&#10;                                Brush.radialGradient(&#10;                                    colors = listOf(&#10;                                        animatedColor,&#10;                                        animatedColor.copy(alpha = 0.7f)&#10;                                    )&#10;                                )&#10;                            )&#10;                            .border(&#10;                                width = if (isSelected) 2.dp else 1.dp,&#10;                                brush = if (isSelected) Brush.linearGradient(&#10;                                    colors = listOf(AccentCyan, AccentPurple)&#10;                                ) else Brush.linearGradient(&#10;                                    colors = listOf(Color.White.copy(alpha = 0.3f), Color.White.copy(alpha = 0.1f))&#10;                                ),&#10;                                shape = CircleShape&#10;                            )&#10;                            .clickable(&#10;                                interactionSource = remember { MutableInteractionSource() },&#10;                                indication = null&#10;                            ) { onLedClick(index) },&#10;                        contentAlignment = Alignment.Center&#10;                    ) {&#10;                        Text(&#10;                            text = &quot;$index&quot;,&#10;                            fontSize = 10.sp,&#10;                            fontWeight = FontWeight.Bold,&#10;                            color = if ((state.red + state.green + state.blue) / 3 &gt; 128)&#10;                                Color.Black.copy(alpha = 0.8f) else Color.White&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    ) { measurables, constraints -&gt;&#10;        val placeables = measurables.map { it.measure(constraints) }&#10;        val radius = minOf(constraints.maxWidth, constraints.maxHeight) / 2 - 25&#10;        val centerX = constraints.maxWidth / 2&#10;        val centerY = constraints.maxHeight / 2&#10;&#10;        layout(constraints.maxWidth, constraints.maxHeight) {&#10;            placeables.forEachIndexed { index, placeable -&gt;&#10;                val angle = (2 * Math.PI * index / ledCount) - Math.PI / 2&#10;                val x = centerX + (radius * cos(angle)).toInt() - placeable.width / 2&#10;                val y = centerY + (radius * sin(angle)).toInt() - placeable.height / 2&#10;                placeable.placeRelative(x, y)&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>